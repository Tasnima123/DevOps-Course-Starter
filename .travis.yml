language: generic
services:
- docker
before_install:
- docker build --target test --tag my-test-image .
script:
- docker run --env-file .env.test my-test-image tests/int_unit
- docker run -e FLASK_APP=todo_app/app -e FLASK_ENV=development -e SECRET_KEY=secret_key -e FLASK_SKIP_DOTENV=True -e MONGO_COLLECTION=todos -e WEBHOOK_URL -e client_id -e client_secret -e disable_login=False -e redirect_uri -e MONGODB_CONNECTION_STRING='mongodb://tasnimamiah:23i9JNvICJHPoG0fhlzOHdUtFP6KAPc6EqbvYXHvhyzYN9RJlrF18pu4c1hcXhqTCPY5w1APNjxSIMEsDvrO5Q==@tasnimamiah.mongo.cosmos.azure.com:10255/?ssl=true&replicaSet=globaldb&retrywrites=false&maxIdleTimeMS=120000&appName=@tasnimamiah@' my-test-image tests/e2e
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
- docker build --target production --tag $DOCKER_USERNAME/my-test-image:latest .
deploy:
  provider: script
  script: bash webhook.sh
  on:
    all_branches: true
  
env:
  global:
  - secure: y1nfDSfF3/+vTpk32GC771VY7mcBz84DH7qDlJRzr7TtKSL0/Ya8XhBgmsu5FZ4buwSrzc3Ua3r9t8SyXXC7tCXO4S+eYlIDmq8do9XK0Np+4GNqERuNqY+fq6pDxJHf3SL3n7U/U5L97uJKAOXyCjSDOTlDOTJ9fgf8BZ7nxYCwu+4Xzc5VYN7hNde/GWeAUaiSxPBPnziNBVW+JwJqoafOjMGo1SAFxp4tl16SZLZbpSigF+iTeLF2w80ZNdqgmkiH7SY2Jv8nART7DnkifCTL68PBz95AX3sbUjCHGxU61NS7IJBMxeYbQGbjZIQFJH0c2MqfCsV1Qqc5KicVMkqAvjvIFmpuz1FVWVyfbn+QAUzX9fqvzxK0ViT8Y62Zw4kd7EQwL9VzWXlqNYUAI1uAvEqp0YZLyioFZzd5w5UrYKzf0jNau0duOm/ShN+ggbhZ/LpkogahCuQrwkFPpk4SNevkdvk8yIWZgjnGPATgxD25C2wGStH+es7jwxfrT1oQSGvPmIVkkMq7HdZ56KB/uvSJK28zwLFmYgvzZK28zlST5W0Fhhs6CDNG57GvqE0obTtDE83bLfxYw++lKnzOvgMiJboJM4YdZj9gDr4smjpoEDwOXh6po4Nu4+uLKOsf6R8A0bQtFjBrWVGN93abJV/U+SyDlcSvIVSxuAQ=
  - secure: SqWtfkrApujjHus5KaHOxfd+eI7ek6pp/BkzTy+ezkf6JKn0VrCa3+S4mf0FvdPu7rhh6jgSD4VY8n4ondGHFmWhh7vkor13kt926xkajHkvPyp7CLev4oZ0Xd9/pR1ftVOHe5/+E+GFBcldLITm0tud8/XSSWEBNHIbMbasNNwvSQLFIRUBDE5dqoPCE9YIQ7WVmMP9L0Gk2/U0wzxdIpUbItrYrc0bpbaNJioLFrW9S5FsMQ8IiKzFMj72ienm9Oj48itOkji5oZpiaHAQevcL+0trLdwDQH0O8aosMT/J/yPMXmoe+3raVfyH/qxscrLTx24JPnyYmz9DEcbABske4sA6rXCHowRK8L4qHRytkikKSNLvQFO915Z8NuVc5D1bK41Zkyt2w0Y4Wca7sCvDx3/Kpkn7zDpc2DhiALe+ABZscx5NPiu+Nu4oBxX9c9lQM6RhRKeMFw7ex0yQihDldYDZCu2aEs102roF7uNrN1NF+z/LxfhIDkqqM9G8aumKd70zklh3dAqAvjO821OMQq3RlqlJ9hB8569VvGJ98wC2GL1XMcQLQo6J2OiboIOiRX8sEaPrmQ6lp/MQ/PRtKTsYX7xJV+/BXUbFOBVQ7mDkHJfv/FMtWENvl/Q/f6OXV4B5SWMXSbVML5Dw3UsfTlhul57bMJoq+9Tx4so=
  - secure: q4nKAuNfLi17lROklvxnim3RDvoPsNGiIxM/8ITzur8TXfYJxKu6QAHdctfLOsXlX7sP9w+ViewwZf4BcmOK+SnvwqItCI3ubX7qYQDibyeAWRlS5U3Ar1SazWKJwOeX9jC1Nhu7+8uHh0TMfwJtHccb3e+9AGSgVUjsJKUwuJenu+loPFpiO63u83pnOKgkQixyTBaP867jTleUuXGCq0Zdjo2tVu2pIsAE5yppnGEIuAo4LanCtuBUjdgD7IJvsEE+uIBuIOiDngKiQLVw43R6dU0ExJ7b76XJ/4wlh5wNygtCbn3F7bOMecouCmY/KviSlFLFkfhu7b1clawV4tyL2bGesWM++xGI9eD5zViiE8196PO2CD7NpL5ISO+9q9ceAkcha2zvRRzoO7T3RZ2BoWtMAx2tZKE9gGbhcziCan9hbDaeXR+9dKQYQjeShxEs2/+5QSDHt7/Sy5b8sX4Eptg0Pz9O6ZucNv7YetdZyUR7abqFqzmXEEhrHTA3/13tIKLK7Gty3TxEX7Ib6Rr8JWzo+J2DWLWzTacqNialAgThzhO0X7oRsrexoiJVpkvDo49JS05Zg83Oe8t8EmFk+72oslW4dE+yWtsYiT0ECsRlOSasKARgFvnplilRDokveuTQVJtsBdTW/XoZhiOG6syK9FCkktl8PRoxGTo=
  - secure: SOs03+4KQQr8tTr9pcylD9WAkMcJEfVtiG4E2DsgVwikX8CDgUbTLVhx9aoGsQ8q4gqGeiUyy0zG0zQDCaZuNN6Vfdf0db5FXBoHJ4hLHwm9KculQGe78v5eaoSoXds1/M4p9vQb8dNJrIytJ3Q7EjaRJ9e/GGrXPuM6tRs5WtvkcOm6LlqaS7wlNVShwPwEtlqXhUkn1b0JKFpsd7bEJQnm+GMnUGWDN2M/7+3i4GirBS8ms8AYjgQm1Ic8sYrLWqd1M0uw/Xje23GWW0vAtF7DFQ8EIV8D1Aumb4vW3YuOHoBG/Nlh6siHf+vrcw8ht/aEo9lY8GChlfz48T5FlxSfq5khSOmgDa2IdAnTBTaQboj9fqteRZhmLAd8UTtvJSooTatkl2mrPA+mSrl2UEpn7FiZmdkYsPkL+HZjfGdQHJ7fOq6uPwGs8iJT7KZnL00AlYCjADl8S2b4isTSGpV3bFCRYge2G7mAgeH0RnLpsiJIBArG26iAAEmL2uK22Wgve1raL25pOPFissc8ktCPAMgprM5gTjTpudFllXRgbNkqI6fOh0qskFCbBO6yaumcg1SYiuZvhp2Tb/b/orOwZCU3w8J3tyKwoggEQ7ih4ioLkI4ScyVRrQ+dj5yjCoU+BceCypQSSM/aL/tMDdntkohUWkWPDDKNypbFy4U=
  - secure: HEQyQmkcN+bwqi6lNi0hlqTX+rN3bG5VPKy3zhssY1OiSHUrdbLy8qSpqGPRM8/D7psRX4r5GyFW81JS6x0eo/cEetEb7I3xGr2NbzNR16PQxI7TdWUGB2ZAOC1n8P7/NIrY59KY+X6ZjSPydHv76LAlotyL/Ihwi9qS/EXc5MRSE4jVVbMFuxuYn8hKutR0v3it1JT0pVaCAEwM2GhYD9svFEhPFjO1GYYHu8lmD+PwlX8O6kCB4HCmsbPnVxiM8W4wyLtY7zd39BG+tbI2RO12V9ZUvTW0z4VmX+WJ7wZDq6NPT0F045MfXB0/+ZIyuirAorwr9kCtJAz1c9zXfimO1Vgdjo6B2CbVXn+VXabYvPxvR/duacy4r+ep+m2AT5NAIkcf0t7DZINCKz4W3Bsta90mPALGWIrQUYBkpB7gNb15LpsTSHsQkztqfj8tIA/B/MomWmOqNbc2Ef/ovGhg8q8xDi8Y7g4Mv7M1IMTWQ1krCcyzJBl3g1THSPHLDGzJWyHAHpJGo4wBwerZCSQqVS4eC/WvFBSyv6XTvi7zfkqLhqay7exaDzOdPqdtGFnGD/TG9Uo0nuG7Fk8gSn5px3oKpfeTDxKHv0jJL25I3RJuio2UjlV6yjHVSV2klgIm9AH9rN/uiCmNv2NWWUtdNL8x8ZA8inKPpUKFZvg=
  - secure: o3gwmb7gE7sOVdZHalIIvKl9A7YPiUrRotH3kfzsAez2gtxn15JYZ47VBZ3krkwHBVWD4KygjSQLCIeCbR6JtcUvlM+Qywk3OW/VfbcXKfBiLsD6SwbStSjXzOOitWJMf+MgKuQRblbN3ha464B3ChwWJlgCdz0jN96OCOtM5lj80yQcTebsx1U5rlxXe1tTmOoJNE8LMqppNBM07sysXCaLmwDJWrHWvYmEa0nyLAjF3uMEovsNZG8eASwVHA6EZvzHPAfL5ijl68CuWt3iKnXtTNKvkyxQMPI0LcCcD7oEBzn33KFFp43FzIKs5ZzENP5v2qwQ26tVY0T+qSKg6v918cMeAMTeUcsPRaUGuYWbVJ5h3VpLqMR0HQLHj5MOWDS1P8sl9xVqReqgaYrju6juBOWnm10recrgR6FCrf+L6CJhi5NqfuWSaXs4jDNzyX4RJgYshV8c3plV0njFGm59pMgUBqtvZY5PysIGKpacc2cBxTIgYGLOERllp0Vxa+ahCOSi5KdkaCvpl+QOLVt6vNsTm7Ihl82tVIWE7KU7UymoI6jDTSTsdll4PnVB3qxGL2tvoUAQnRmMfLdWZ3vs/dKdVce3cybQFhTSdac9uIDJPGTNLLHLkvu8caRopqU1GCjg5qgFOGopVmgjNYCfwTgBUu1W0+/GtedjW/o=