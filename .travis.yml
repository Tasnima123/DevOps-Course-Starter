language: generic
services:
- docker
before_install:
- docker build --target test --tag my-test-image .
script:
- docker run --env-file .env.test my-test-image tests/int_unit
- docker run -e FLASK_APP=todo_app/app -e FLASK_ENV=development -e FLASK_SKIP_DOTENV=True -e MONGO_URL=$MONGO_URL -e MONGO_USER=$MONGO_USER -e MONGO_PASSWORD=$MONGO_PASSWORD -e MONGO_DB=$MONGO_DB my-test-image tests/e2e
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
- docker build --target production --tag $DOCKER_USERNAME/my-test-image:latest .
- docker push $DOCKER_USERNAME/my-test-image:latest
- docker login --username=$HEROKU_LOGIN --password=$HEROKU_API_KEY registry.heroku.com
- docker tag $DOCKER_USERNAME/my-test-image registry.heroku.com/devops-project-app/web
- docker push registry.heroku.com/devops-project-app/web
- heroku container:release web -a devops-project-app
env:
  global:
  - secure: sAhZCovvvpGitbczPf6j5WlEA8HbtWkLbtRrIikr52G1sDGVGamfuSy0mqAKJ+zfPti7yKiRZMxCYBxD2aJJ+r3j1IxVhvA5SB5Febx8a5Gn2q8OROY1yfkUwJBkXOj/MOymNhPsKgE6gXz6fntF2ghjkmTr9Ex7ST1w+323nrlZanfYjoYtHTjqZgcU4ISUcDwVe9SI9yA368SrkCZdazAz12nVTUmHFTmAgcHDgGd6hDwmJbfXDv03Qyoi73Lg8jM+dA58NQdp3azjwXW9oAqdDi7P3APRFFUtqnNU8LtYnBnSZkYXUFYngVfBX9YisKfw/z0/2akKadyUDlusVGOMRw/2vZ9qebc8yFM248U1eVOCnpUm0hdFtmgPIzL+4blHvS1nFK8nNGwxIvGqnJJvR0LNBoSXaUBpVw5nQOSOvB/9FtV2DSoMHrwfKLZexbBAicapRjKsCEbxFBAWu9j4QMmE7UhGA34uauzP3ZEgWHukhTuOyRysQ2slnMtPS2oTmamlhQyhCtgSVJnLqCZj5lnQtTXpgrx56UYHZhYOENPacQjHRD4Ml6V0ulrY6KzIMG87ewObXaj2gBQ+5uVT0jUy6p1FoqD5rWmn11CNSLvEFop/i2DmNK1rfLknGPNaFLG9oz3vf7kFMTacIxcYGH4CHbCMkj5ouyp4yyY=
  - secure: jgN8c2sIszE9htC07D7MUTbRB6ZOOLbLm223VunLxCYK1JcK2RfCTnlwBTD8OthPs8UN+R0oabqasEuFUojYbDAABXY7IdYR9zAS6clOrezAEIgYamEzSif43NdfGN8ufLMfAr/Xh99BaVb/QZzvySJ2InbdOc2Wfwa4kxe1qvxfFRCJxcdxjd9ZLhRTlzeFW2Yy8D5tQd/8YM/4Y2Mok/yILRnGRvzNWSgzQWv6eOv0rS1NPGYtC3JfdLpCdl37m/Pst9xhVqfKLvK6Iu4CppExnmhk+7pjrugRPO2JV/Z06qM8FE8E9FTwaArQI3rn9JkSUr49GW0Te5ON290fE1Kgx0CGOcSUgDCRSzH4aZo4q4cplFi9RTFZleMRdak1cHwsqcMo/yOz/5WEwVKPIrlj5/zTWWw9mFKNy0VQJgf4SUscH9xaD8I2xw2MAIK1RDOsYPyeLqntzDFLEZRihgYvPiZlWEJn6qPDptEHpOG2v+6NyWkt8aoMXEpWD9G6//gsQIO8PpJPF47wqWxuuPGxxuVYQ3lB20rv8jwYN4DGADiFwBh+VRVIybkpgISDuUSOYoYIXdQJdWrFzJJ2b5d2uMQOeWza+rL12bkOWRzFtkTNpORmL8qtU/USauCf/A9kPHJs7E17dMwSFmSDU9bsSYknZC3z8f1AVyTC6Yg=
  - secure: sHQnwfKGS/T+LLO2x5R3KZaDl2kGkTqZRj3xngieKdJGhhQ4e3u07S+IjwJcSkNV+7PHt1MW/uyz5cGpVxXWrLXtJTSdoIdX0yCFSeuCg4OFV+zLynbEvfFflEvkq6sIzf5kjc9yzC6agjIOA9oX87NP8ZJb1RNyknDIKeUctmNZoZS8R+nKc9+NGG60bu6UsbxxZL8MxemBgJOc/rDJEtWWf8+SyhmvuNycJo9s9BEDMQ+c0mJVARnoJKaGPJ996nyIxuIK7sb5Y7x4UUwRhssnjgBqsGAmc2NI8rSPDXRvK6Qm7Kshtw64Vr5pYhae6/IXoH/hNpzCMg/9Ymcv68uaWkHpthi2sKU+Wsyqp6spqf2samPncHHO0jr6DB1+smNpOjd4Ks84CUlunyL2InbjerdMyqObff5byQYurWrJ724TOkCawC2ZGa3+vNO0d3zHASyS6eJ+D4K80dMS4+fn0X1Cw7OFXBLzkgFcsyBbVrVOAgHX70Fi5ia2Xdp3DmhMSPyaOqnAkhFXD5W7cYK6/zxMa0+7ssuCxBhpak+qpBFnpJ1ZIOYxShInUz+SBemnrrSjwqPRqBObKAMfOvslnqfh03PkNW5R26v5WSeeH4lRoHRWkgaxi7zxY1NwMkwal6zL04ZyEoAzYtaeWH6ujKbLupe672V6mQ6jF9M=
  - secure: WrBAkg2OGCwO7TiaCBukdBBimJN2cpfwxFiw71gkVghNn8c8gcYVJLVV/kl6iyBoYgNUH0d7lxJtK45oGwjeMeDp5gSWGTcAzRtWkrCnYSd1+t3vRvh4K2f/sPHMxFJnV6D7vvWDIIhTtl4m//gfTMJZpfqMGUi5kIAmw18B3WGhti2zvY42FKKpxybj8Ojo3rkb42ReRyS/HlpYWlvjY3TybSrF15RXaCr5YPigU5Axnmja8X7Z0lPKhnUMu5d8dtN4FG+PDobVV0jxiTo/nNrMntMk57gOJvBbTGeJGyxoIhIQ59VNzFHRS7X0HyVF4VNUd4ycMzk6O6Owhyo4qRW0gZ4O5FptrVXU/9S8r9kwNPWGepN6ZBC3YljP3Y1tAVXMBQT0VKR73p1IhoqX2g2fB71R2tM9OZXgxMFhoyGi4B1V0LF5+1EwICmS3Ep8KlEv6V/NFyxnfZIXqUWRYTNX8CwPLcRUTv2knPhvy7JaELYfD+cLEPEPWtiiZiVhlqpYbF4fNT98f2Z0Dt8QnPsWZKuBCWa0BkyT5FZ9HASFWDMu/qXmPEaJyBXDXKqnFAvutQ+tHBPHDQFENtewpvcZP27x6yr1MARtdbbdWj+8GaW2Si+CiccI6rQYfcFeQ6S+5Vl0Idu3je7ie9Y6PkTJcn5nyy/C/FPJcSQ3tVA=
  - secure: dzgV4l8nJyJoKdZYEGvaRNGY7Y9asTL46JFZdY9nIeNKA335H6bIAt9bgCV/5xgMfkZz+rC/McWufWIg9MJ0eP8gKQ2wa89E9Uk7yeHMznf/aeEqKYDSXZJ7Ik3zVqFc5T7D56ThaU1d4dU2N8GjnpojBoqKSWRmnyaASfBuGXQqU9qTLs0rDJxWpFQcbPStG73XFEOBEw1kg3l7WIzLGv3Mde8ooZe13uOfoctHnbJujwFQ7id/LJPqwp4YB3YjveIc62LBGGGm7aC87AOFP7XhMU0uGa+3rqvDBTgYKFRAr8dKAB4fnBGBILZjwoliYJWBIjZn9dGcMKpV0miUAC3IAUBBvvd77RcIKrwRFcad/3AqX6cd8KRHZfTC7tCzDyahMtBtnVDK2XFRH/rtAlPbGtT+oOuDWc5JXA4r7dnPARPgxuKXbKVHQUlluAL9L3mdtoMfg6HpG7mqe1RWa0746kRsQ8JsV3FjHGM5W56yEoNJtXgHHabayYdZtH7jGtoEpwtYvzsTrpXqyuTCjEyAPK4cjBtP7tcfa9SFLQsPQDJ8x7QQbLjz/TqQ56iEqP0xY4BeOcqOpoLSz/WYrR5lIzxaApsIrIYROgBP79OG/jTbnEhxylTKgjEFXlJ5PtDMGz8niSS1L7ygoIMwDiI5HVbQAP5T8iBKWDJiqSA=
  - secure: pLajljf1VkTa/hxkI13VtKUiKYMTMzMu6CmpKFC1AebPsv5OwosiS9yWRyQpqLKSHo+InwsC0xNUD4wAcRj9USXvtZLyQGsrq3H/9OVvk7lSKaeEJnk7H4aCk3Pzv6APs2VLrPMokpSPISZJ4DR5yE6R/EdQ7/zHDp25CGnCQlHKxXYykp+2Vm8/6OjLm68SZ239B49NuJiNXn2/FFlRl7/YbX0u0acAnx13u7fHgaGOZ6fOa0w4wpHjNC35yFPKP32X2gscFenN3m4G3U9zysSuCS+vNtZr0IyxKLTNdCuX7nhkF0aCHb+1sVpTD6kXUlsvJA7v/XAXUhkywoyTnNrWHuptYGbW02Cd8O2G20H8s4GfFqknwB0CdX/WYpXmkeChcXUF8sN8E2Gs+UucO5R5U8+ga4M5z40YWbZACCde9+pXLxOA9OL9E5Do8Hz+IHj13hhSNPZ5fuQdgkEK7WtTDCYwTSrs7DNs4bJYkSGNrWN8nq3Le+6J3Znvy/9YSKzOcz8SiBPQKAnjsCSycg91/P2IoaIWqDmknSfYAgh4azBh5EzvvQA1RuLyckR2jpIDCeecVnmcdiaCDs0BCma2spPUNXnEyfa2pPTi5WwC4GdHpKWquRH/gVEsPqR0FOuxbpixUA1g2EJvlWaTZDkB0nxGN0/zkAU65ogkRMg=
  - secure: y1nfDSfF3/+vTpk32GC771VY7mcBz84DH7qDlJRzr7TtKSL0/Ya8XhBgmsu5FZ4buwSrzc3Ua3r9t8SyXXC7tCXO4S+eYlIDmq8do9XK0Np+4GNqERuNqY+fq6pDxJHf3SL3n7U/U5L97uJKAOXyCjSDOTlDOTJ9fgf8BZ7nxYCwu+4Xzc5VYN7hNde/GWeAUaiSxPBPnziNBVW+JwJqoafOjMGo1SAFxp4tl16SZLZbpSigF+iTeLF2w80ZNdqgmkiH7SY2Jv8nART7DnkifCTL68PBz95AX3sbUjCHGxU61NS7IJBMxeYbQGbjZIQFJH0c2MqfCsV1Qqc5KicVMkqAvjvIFmpuz1FVWVyfbn+QAUzX9fqvzxK0ViT8Y62Zw4kd7EQwL9VzWXlqNYUAI1uAvEqp0YZLyioFZzd5w5UrYKzf0jNau0duOm/ShN+ggbhZ/LpkogahCuQrwkFPpk4SNevkdvk8yIWZgjnGPATgxD25C2wGStH+es7jwxfrT1oQSGvPmIVkkMq7HdZ56KB/uvSJK28zwLFmYgvzZK28zlST5W0Fhhs6CDNG57GvqE0obTtDE83bLfxYw++lKnzOvgMiJboJM4YdZj9gDr4smjpoEDwOXh6po4Nu4+uLKOsf6R8A0bQtFjBrWVGN93abJV/U+SyDlcSvIVSxuAQ=
  - secure: SqWtfkrApujjHus5KaHOxfd+eI7ek6pp/BkzTy+ezkf6JKn0VrCa3+S4mf0FvdPu7rhh6jgSD4VY8n4ondGHFmWhh7vkor13kt926xkajHkvPyp7CLev4oZ0Xd9/pR1ftVOHe5/+E+GFBcldLITm0tud8/XSSWEBNHIbMbasNNwvSQLFIRUBDE5dqoPCE9YIQ7WVmMP9L0Gk2/U0wzxdIpUbItrYrc0bpbaNJioLFrW9S5FsMQ8IiKzFMj72ienm9Oj48itOkji5oZpiaHAQevcL+0trLdwDQH0O8aosMT/J/yPMXmoe+3raVfyH/qxscrLTx24JPnyYmz9DEcbABske4sA6rXCHowRK8L4qHRytkikKSNLvQFO915Z8NuVc5D1bK41Zkyt2w0Y4Wca7sCvDx3/Kpkn7zDpc2DhiALe+ABZscx5NPiu+Nu4oBxX9c9lQM6RhRKeMFw7ex0yQihDldYDZCu2aEs102roF7uNrN1NF+z/LxfhIDkqqM9G8aumKd70zklh3dAqAvjO821OMQq3RlqlJ9hB8569VvGJ98wC2GL1XMcQLQo6J2OiboIOiRX8sEaPrmQ6lp/MQ/PRtKTsYX7xJV+/BXUbFOBVQ7mDkHJfv/FMtWENvl/Q/f6OXV4B5SWMXSbVML5Dw3UsfTlhul57bMJoq+9Tx4so=
  - secure: MKtPBTtqBMSwcRFcvl/4NZsR/I/s1zvee5XDiaJwM8w9Si9wpNlsVlvu2inE7Y+n5x+K/srthfvhbdewGFExXIaQXI/wBD6PFw5hWtpcyWkvLWu1b+G8FgccOX2X1xvx8qq/UB19nYAfqvcyQkMQiD8INDIZWeh78QV9oD/sinwFgn5zxWgbLTES8RAmZz9q4KcMFjL/FHbUElvWbbGgBt1zEY8tTiGp/JYtJ+h7HMrkFw66ByLf0AUbU+1uqzW8ImxDqyuNlAY5Km76VMdT+uDOF53NZQ0DTApPwsHans4gLi34Ca4j2fLixE85JsKiR/NZnJ9NlyGtIw2Y/qJhEvuk1RNK/23bLzNHHmNASUkYlWSKYMN3nmgmTUgleRJyX4Fb4RGkeCRHqfTQQDkoFTzYnb8fTBVCcM3AEqnS+gKJIv4qhw6N7xOdZAHbgAk/5rFaakjn+tKiXVTDtYzpo0VIt4xPZCgb2wotJ9ZPfmmQgRzftIw3+Jmj5J0B3sZS3G7SgfZG4T8AAiEh52FXgu0Cu8MrZ+O/nGNbM3I78cSl57QfiT9ZvcjeRGODpQlCBr/Dm4tTuA1t7AXIbn/DdHR9Z7XqGl8A+UhV8eXAPWCc2gKXK86Sa8ublRdSxckiDbvDvP8cQrSI7gFmveYj+mvAwWGuYUavzODfP1DHVLk=
  - secure: uUMbbzcKb2WqvAXvb0TMfcBv0EL2PsgWlZiQag5mcw3/Vs4GXjIpUAN6uktEzKxTkEyLj/sYEEH7wZgr4P282cjfx/asnf+hsINDjcEMlkM+4tEDFtEORkZrj2NpJFdHVE0TTnAUGREJzX/mli8BSQMM5gUtEAhnAs/LgthHj7jlqJh4xxtNeSqikmzMmjQVQ3blyjlfak5lNjit2m9v/JehxKtMlKht3AiXUXKnPkvGWIqCxUu5MxA68MmAt3NZCUJM35YFMXZ0kJ4c2ghpffEC292FGnPvfC8bL3xlnVrSv1PmudAUFeCL0bRk3yqMD03gzt9fF77U5DyoALvxTpUYKxl9xC4ORuUshXUdA0SEIsCU4aIWaIlIV0vjrcucd3gxr1J8TzvYrAWmPLMQ2YkpTeBeyQfzWQeKPf55CiUF+W75DPnVuxRdHCiVvZrOwq4oKCsvFm24cyBVEkoV4VawcidbjeraakaUG/YKbTh1LrlMcty/VGf1OJwapiwiz1S6v61HBY9C4ryDgFbcpLe9Oj717ovwOcJ8jP6jpUzkwF68RdFgFYidhkx3AgdVsaYV0vSTMZBIyx612BCVMAt7ANnA0HtovY/EGWPsDIZd7lo5RbtkZb8PDJt6vkOX2LCD9FA6Xt2/tc0WNtOju+hPR69j3XP8tVDrTk+yRuQ=
  - secure: mjhsGFOrnyvtes9MgwhpyLoQn9l7f//+6y+zrz03pdvjpy13AyTcjIDwH5qMXGunx7CvfPv70mazwG4l22vT2cL/ti8s0duFkKlmhx8YnRAS+dnGJR5QyhgfFLnXNdiaIH6yLbFRfDz9O0Vkxnzk/OKqshBpM/fKdrMEyiynmDmTM0wgcMTwTAEINY6Fo+00llweF+31VtxnkW0FgwG9soJjSWR1qdmh5aPvuKHOM7z7d9t/DwWDiooZYmbmNKrOvjp8p3eRtDSNoLufbSVKgSIw/Cqa2c6rxHi69PcUa1RcMbx3ijeYQDKkcjj1pUMt7CrmEm2zA13BtZuE28v6IV1AEmKaL6LQA8HVB0Qxg27PKyTSKAlsUWJ0r8JvTUnOpAbT+Z2EGGPpBvYopn3NU6cGkDDQ80JTLUbbtlKBT+PcMCLanYCKPULz24v4wmxiymxu8xmyO1DjdR5d7hPIHT407ZInDNr5TfCOlsH8txKAEvJ5h2pP176LKDahbArcBkxSVKQgky21sB9K/x1MVYsiIACNdga2t5R0KEE5AWf+jWyxgZtCqaglHvKBU6XSi9HlhLTnjj181Ctm3QzWo0C7GpnAyw04WDOXFmeNFdeMupwcFLFv9X7j07XSU6W75hGqfqxBcQ6UfUlXv268j2PsuaPQTeb/xMWvzykj2YE=
  - secure: nZbK5ZUcOPPoquT3MXZRG5wXL7HtlPJzbr0diqZVxdr9uNUeDuBXDXuLYZqIMtnsErdEPqrSHJyE5yc1XP5HifdytSJOTmtylQlUWyHDglXPnowA7LBQMwycRZ4HLduIisZeMGmLjPjgWqesrUw5l57/u2JGZnjujrh76tgxCp3QQkWG1m6bvf7YmDrYpCx3LvJhu+0ZUegdZvE9dGS9nhSDdFHqLoyhikZ9UqXInEsZ6KgqGG6WmmDu2u1e9jC12BqjMMkOyrWBYkx0tHlo8UqwIG9gZhykvUlXnFz3P7lQwc3mVYC/FN5a8SU1gWesMNmmF6VfTeAOXK8SkxpPaykFKYHSb5/ZUfAmj3U69BBK1DDVRz58QZmngmcWvtkUokUjROfyomPSDjQSezd53xIb2prPN81FNiu32HkRr1asNlzwj93Q8nb5XknTEhk6EFbsKGn8yzzVJWkWLD6QTN/TkorJ4ZHBx6ZDCkXHBbk9wq5ea8l5koe2LtP97D4Q9vu5BFEksJXO5MHufLg45jJZoFKcw9vcA+Ebbrx5XyW0opHUwm6rCSy60sMdWnNlogdfomsrMx/gjjCQ4yOBzyYqhbjUHa8XKCMokdEPeZP+/AnhX0kc/WvYAL4wpJ+gOpO6r51XB7Gji3ICflFPsxhXArqwn6BzvA7t6Z0u7+o=
  - secure: FWpH/p6lXD9/M3fRnrB0sj48UlAs9wuaBtnXjUyB9kDzN9ajW2pSnHw1rZAhaq4iBvUEU0CTn8IAkrTAw94uGrbLK5Qkg5S5ycUMOCpcFWYlFGYmsmVywL6OdnekuRxdmJF7+HmqtSGWSb8NMu8zKZUyWiEjWykfaTzUBab+nJMtOIVRPg99Fm4GKoM5LzOAMukVE+bi+Ba1alxjaFwQRhtxwG67qC2ndHFpZd5Xu9Cu+38Fb5H8Sz9T69C6AMlypXJy68g3iVEIXJMwKOAOhLhHscaAGoZJHn61RA9OW24Wvoe9TVLUXsD/Poktv0DdgcgkrBv8W+XxpEHiqGXjUiHUGXirQeaDm0S8hm7gHQ7cH8ipLqSxxji3h70L46tbq6UID8VCGhCyNjxCszCPCg0Rh2eBE0iwCMntOH0nFG1Gtb9kusPDhs4MDwEkKYOgR57t7zGBJN40YZBku+7Ro0D0FUIRZUZLa6AtI942fysFsP4DWr1oxFsiYC+Tff9JztDouSMEojwRlKmDggNYY1zFBDNeOcJaZXm3mfVb4ebhTm4Xd9JOvGWoL0ECRoXrVt3v31NLzYih9jIIB9hpR8mRrLUh167N+biFKcstN5Q8Wk2sMYQTq/XFIbkB6SVvlyciytrMp6DfhdOFC4Rwok/aUqlpSPcNdrCDZonY+KQ=
  - secure: PH6GZBy9oSjediileQeHURwY7HbravoX/Wz/LLo6uPZPAl0gGmZ9tWNgPVqooIQf9I1OgOPp6BxcPOyqAhVKTQ7lQq4XZNNH8jDnVRNnJewbUkhnrNq9djW2ybG8ATXLTqmBNo8SkAetoFwmI1hL0WzWtPPrmebBrqTaEwL2QEqbLO3f59wdZ+OspVq/XqiTP1UpiIFkbph9LyDaW737txDl409g0bYpnrcil0qCRXP9YdUZ+960B8W0MeFu8bZvKNlOK6DDAqWerIan7A8rkX/2NADtE1Fx07nEi6b8kdJblg62bGd96ijJrNsRP6GIy9QH+A40VBelQMq89PPagUUsUWyE642HT5Y159Zmp19MmGmQta1+ziD17W7wi/7fzmIkUtqDGWN9cGh9oDOEW/DI1svPyW3JsKUmfFpoH+kNGa4Trf7mdhqKuD4Zc1ez00UZZtTQmummriqyR2VxnytH0iDQ1ZnImGGoBPHD7dSfDw8jmMpma9ShZOjfxkxmI3EM3QwzCKK214bEazMNo/GoPNVFMe1GDyvoZKQA979CSidUBT0NZqg31H4OFXOoLCldC0wolCTIrogwesSn7wg3uv057NEA9qa66gAg1Cl7hWbyjw6qsg/F2pq9FFov5DVKVWfTpxlnX4mZ+bwTM5K6xw+JLuPTfJqcGmwcP+k=